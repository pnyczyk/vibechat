# Tasks: main-view-visualisation-markdown

[This file is generated by /prompts:sdd-tasks and tracks implementation progress]

## Task T001: Implement Markdown Rendering Pipeline
**Status:** Completed
**Dependencies:** None
**Files:**
- `package.json`
- `app/lib/markdown/renderer.ts`
- `app/lib/markdown-store.ts`
- `tests/markdown/renderer.test.ts`

### Description
Install Markdown + math libraries, build a sanitized render helper, and create a session-scoped
store plus `show_markdown` tool that validates payloads before updating the store.

### Acceptance Criteria
- Dependencies added with lockfile updates and tree shaken for client use
- `renderMarkdown` returns React-ready nodes for headings, lists, code, tables, and math
- XSS and oversize payloads rejected via Zod schema; tests cover positive/negative cases
- Store resets on disconnect and surfaces change events for subscribers

### Implementation Notes
- Reuse approved math renderer for TeX blocks; escape unsafe HTML

---

## Task T002: Build And Integrate Markdown Viewer
**Status:** Completed
**Dependencies:** T001
**Files:**
- `app/components/MarkdownViewer.tsx`
- `app/components/markdown-viewer.module.css`
- `app/chat-client.tsx`
- `app/chat-client.module.css`
- `tests/chat/markdown-viewer.test.tsx`

### Description
Create a scrollable Markdown viewer tied to the store, render the converted content with design
tokens, and slot the viewer into the chat canvas without disrupting transcript or voice flows.

### Acceptance Criteria
- Viewer shows loading/empty states, renders supplied Markdown, and offers independent scroll
- Tables provide horizontal overflow affordance; math blocks render with accessible fallbacks
- Chat client hides viewer when no document exists and clears it on session reset
- RTL/Jest tests cover layout integration, hide/show transitions, and table/math rendering

### Implementation Notes
- Use dynamic import if required to keep bundle lean

---

## Task T003: Instrument Telemetry And Accessibility
**Status:** Completed
**Dependencies:** T002
**Files:**
- `app/lib/analytics.ts`
- `app/chat-client.tsx`
- `tests/chat/markdown-telemetry.test.tsx`
- `tests/chat/markdown-accessibility.test.tsx`
- `README.md`
- `AGENTS.md`

### Description
Emit telemetry for renders and engagement, ensure focus/contrast compliance, and document usage
plus metrics expectations for the Markdown viewer.

### Acceptance Criteria
- `session_markdown_rendered` fires with payload bytes, latency, and doc title; engagement timer tracks â‰¥5 s opens
- Telemetry respects runtime toggle and no-ops in tests
- Axe (or equivalent) checks pass with viewer active, including table and math cases
- README/AGENTS note viewer usage, telemetry events, and accessibility considerations

### Implementation Notes
- Clamp latency calculations to non-negative values

---

## Task T004: E2E Markdown Flow
**Status:** Pending
**Dependencies:** T003
**Files:**
- `tests/e2e/main-view-markdown.spec.ts`
- `tests/e2e/fixtures/session.ts`

### Description
Add a Playwright scenario that exercises the `show_markdown` tool, validates rendered tables and
math, and asserts telemetry mocks receive render + engagement events.

### Acceptance Criteria
- E2E test drives mocked session emitting Markdown payload and verifies viewer content + scroll cues
- Math block renders with fallback text confirmed via accessibility tree inspection
- Telemetry mock captures render + engagement events exactly once per flow
- Test runs under Fast 3G profile and is documented alongside existing CI instructions

### Implementation Notes
- Reuse existing session fixture helpers; add Markdown payload builder for reuse

---
